import{c as U,j as e,r as y,x as q,y as f,s as z,z as T,E as J,G as B,p as H,R as K,t as Q}from"./index-CWY8UKKK.js";import{A as _,a as W}from"./api-config-CoogvJlO.js";import{F as X}from"./filter-BHsqz3ON.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=U("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=U("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);async function D(t){try{const n=new URLSearchParams;t&&Object.entries(t).forEach(([x,N])=>{N!==void 0&&n.append(x,String(N))});const h=n.toString(),j=h?`${_.LOGS}?${h}`:_.LOGS,c=await(await W(j)).json();if(c&&typeof c=="object"){if(Array.isArray(c.logs))return c.logs;if(Array.isArray(c))return c}return[]}catch(n){return console.error("Failed to fetch logs:",n),[]}}async function Z(t=100){return D({type:"system",limit:t})}async function ee(t=100){return D({type:"training",limit:t})}async function re(t=50){return D({level:"error",limit:t})}function ae(){return e.jsxs("div",{className:"animate-pulse space-y-6",role:"status","aria-label":"در حال بارگذاری...",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-9 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:4}).map((t,n)=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsxs("div",{className:"ms-4 space-y-2 flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"}),e.jsx("div",{className:"h-7 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]})]})},`stat-${n}`))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:6}).map((t,n)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-16 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-600 rounded w-2/3 mx-auto"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2 mx-auto"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-600 rounded w-2/3 mx-auto"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2 mx-auto"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})]},`content-${n}`))}),e.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:"در حال بارگذاری محتوا، لطفاً صبر کنید..."})]})}function se({data:t,columns:n,loading:h=!1,error:j,itemsPerPage:m=10,onRowClick:c,className:x="",emptyMessage:N="داده‌ای یافت نشد",searchPlaceholder:C="جستجو...",showSearch:v=!0,showPagination:L=!0,striped:E=!0,hoverable:F=!0,compact:A=!1}){const[b,I]=y.useState(null),[r,l]=y.useState("asc"),[i,k]=y.useState(1),[g,P]=y.useState(""),w=y.useMemo(()=>{let a=[...t];if(g&&v){const d=n.filter(s=>s.searchable!==!1);a=t.filter(s=>d.some(o=>String(s[o.key]||"").toLowerCase().includes(g.toLowerCase())))}return b&&a.sort((d,s)=>{const o=d[b],u=s[b];if(o==null&&u==null)return 0;if(o==null)return 1;if(u==null)return-1;if(typeof o=="string"&&typeof u=="string")return r==="asc"?o.localeCompare(u,"fa"):u.localeCompare(o,"fa");if(typeof o=="number"&&typeof u=="number")return r==="asc"?o-u:u-o;const $=String(o),O=String(u);return r==="asc"?$.localeCompare(O,"fa"):O.localeCompare($,"fa")}),a},[t,n,g,b,r,v]),p=Math.ceil(w.length/m),S=(i-1)*m,R=L?w.slice(S,S+m):w;q.useEffect(()=>{k(1)},[g]);const G=a=>{const d=n.find(s=>s.key===a);d!=null&&d.sortable&&(b===a?l(r==="asc"?"desc":"asc"):(I(a),l("asc")))},V=a=>b!==a?null:r==="asc"?e.jsx(M,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"});return h?e.jsxs("div",{className:f("space-y-4",x),children:[v&&e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),[...Array(5)].map((a,d)=>e.jsx("div",{className:"h-10 bg-gray-100 dark:bg-gray-800 rounded animate-pulse"},d))]})]}):j?e.jsxs("div",{className:f("text-center py-8",x),children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mb-2",children:"خطا در بارگذاری داده‌ها"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:j})]}):e.jsxs("div",{className:f("space-y-4",x),dir:"rtl",children:[v&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(z,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:C,value:g,onChange:a=>P(a.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"})]}),L&&w.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["نمایش ",S+1,"-",Math.min(S+m,w.length)," از ",w.length," مورد"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"w-full bg-white dark:bg-gray-800",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsx("tr",{children:n.map(a=>e.jsx("th",{className:f("px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-300",a.sortable&&"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 select-none",a.align==="center"&&"text-center",a.align==="left"&&"text-left","text-right",A&&"px-2 py-2",a.className),style:{width:a.width},onClick:()=>a.sortable&&G(a.key),children:e.jsxs("div",{className:f("flex items-center gap-2",a.align==="center"&&"justify-center",a.align==="left"&&"justify-start","justify-end"),children:[e.jsx("span",{children:a.title}),a.sortable&&e.jsx("div",{className:"flex flex-col",children:V(a.key)||e.jsxs("div",{className:"text-gray-400",children:[e.jsx(M,{className:"h-3 w-3"}),e.jsx(T,{className:"h-3 w-3 -mt-1"})]})})]})},String(a.key)))})}),e.jsx("tbody",{children:R.length>0?R.map((a,d)=>e.jsx("tr",{className:f("border-t border-gray-100 dark:border-gray-700",E&&d%2===0&&"bg-gray-50/50 dark:bg-gray-800/50",F&&"hover:bg-gray-50 dark:hover:bg-gray-800",c&&"cursor-pointer"),onClick:()=>c==null?void 0:c(a,S+d),children:n.map(s=>e.jsx("td",{className:f("px-4 py-3 text-sm text-gray-900 dark:text-gray-100",s.align==="center"&&"text-center",s.align==="left"&&"text-left","text-right",A&&"px-2 py-2",s.className),children:s.render?s.render(a[s.key],a,S+d):String(a[s.key]||"")},String(s.key)))},d)):e.jsx("tr",{children:e.jsx("td",{colSpan:n.length,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:N})})})]})}),L&&p>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>k(Math.max(1,i-1)),disabled:i===1,className:"flex items-center gap-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(J,{className:"h-4 w-4"}),"قبلی"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,p)},(a,d)=>{let s;return p<=5||i<=3?s=d+1:i>=p-2?s=p-4+d:s=i-2+d,e.jsx("button",{onClick:()=>k(s),className:f("px-3 py-2 text-sm rounded-md",i===s?"bg-primary-600 text-white":"border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"),children:s.toLocaleString("fa-IR")},s)})}),e.jsxs("button",{onClick:()=>k(Math.min(p,i+1)),disabled:i===p,className:"flex items-center gap-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700",children:["بعدی",e.jsx(Y,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["صفحه ",i.toLocaleString("fa-IR")," از ",p.toLocaleString("fa-IR")]})]})]})}function ne(){var I;const[t,n]=y.useState([]),[h,j]=y.useState(!0),[m,c]=y.useState(null),[x,N]=y.useState("all"),{showToast:C}=B();y.useEffect(()=>{v()},[x]);const v=async()=>{try{j(!0),c(null);let r;switch(x){case"system":r=await Z(200);break;case"training":r=await ee(200);break;case"error":r=await re(200);break;default:r=await D({limit:200})}const l=Array.isArray(r)?r:[];n(l)}catch(r){console.error("Failed to load logs:",r),c("خطا در بارگذاری گزارش‌ها"),n([])}finally{j(!1)}},L=()=>{try{const r=[["زمان","سطح","دسته‌بندی","پیام","جزئیات"].join(","),...t.map(g=>[new Date(g.timestamp).toLocaleString("fa-IR"),g.level,g.category||"",`"${g.message.replace(/"/g,'""')}"`,g.metadata?`"${g.metadata.replace(/"/g,'""')}"`:""].join(","))].join(`
`),l=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a"),k=URL.createObjectURL(l);i.setAttribute("href",k),i.setAttribute("download",`logs_${new Date().toISOString().split("T")[0]}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i),C("گزارش‌ها با موفقیت صادر شد","success")}catch(r){console.error("Failed to export logs:",r),C("خطا در صادرات گزارش‌ها","error")}},E=r=>{switch(r){case"error":return"🔴";case"warning":return"🟡";case"info":return"🔵";case"debug":return"⚪";default:return"📝"}},F=r=>{switch(r){case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"debug":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},A=[{key:"timestamp",title:"زمان",sortable:!0,width:"160px",render:r=>e.jsxs("div",{className:"text-xs font-mono",children:[e.jsx("div",{children:new Date(r).toLocaleDateString("fa-IR")}),e.jsx("div",{className:"text-gray-500",children:new Date(r).toLocaleTimeString("fa-IR")})]})},{key:"level",title:"سطح",sortable:!0,width:"90px",align:"center",render:r=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{children:E(r)}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${F(r)}`,children:r})]})},{key:"category",title:"دسته‌بندی",sortable:!0,width:"120px",render:r=>e.jsx("span",{className:"text-sm bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-700 dark:text-gray-300",children:r||"عمومی"})},{key:"message",title:"پیام",render:(r,l)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm",children:r}),l.model_name&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["مدل: ",l.model_name]}),(l.epoch!==void 0||l.accuracy!==void 0)&&e.jsxs("div",{className:"text-xs text-gray-500 space-x-2 space-x-reverse",children:[l.epoch!==void 0&&e.jsxs("span",{children:["Epoch: ",l.epoch]}),l.accuracy!==void 0&&e.jsxs("span",{children:["دقت: ",(l.accuracy*100).toFixed(1),"%"]}),l.loss!==void 0&&e.jsxs("span",{children:["Loss: ",l.loss.toFixed(4)]})]}),l.metadata&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-700",children:"جزئیات"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 dark:bg-gray-700 rounded text-xs overflow-auto",children:JSON.stringify(JSON.parse(l.metadata),null,2)})]})]})}],b=[{value:"all",label:"همه گزارش‌ها",count:t.length},{value:"system",label:"سیستم",count:t.filter(r=>r.category!=="training").length},{value:"training",label:"آموزش",count:t.filter(r=>r.category==="training").length},{value:"error",label:"خطاها",count:t.filter(r=>r.level==="error").length}];return h&&t.length===0?e.jsx(ae,{showHeader:!0}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"گزارش‌های سیستم"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"مشاهده و تحلیل گزارش‌های سیستم و فعالیت‌های آموزش"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:L,disabled:t.length===0,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(H,{className:"h-4 w-4"}),"صادرات CSV"]}),e.jsxs("button",{onClick:v,disabled:h,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[e.jsx(K,{className:`h-4 w-4 ${h?"animate-spin":""}`}),"بروزرسانی"]})]})]}),m&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-red-600"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:m})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فیلتر:"})]}),e.jsx("div",{className:"flex gap-2",children:b.map(r=>e.jsxs("button",{onClick:()=>N(r.value),className:`flex items-center gap-2 px-3 py-1 rounded-lg text-sm transition-colors ${x===r.value?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[e.jsx("span",{children:r.label}),e.jsx("span",{className:"bg-white dark:bg-gray-800 px-2 py-0.5 rounded-full text-xs",children:r.count.toLocaleString("fa-IR")})]},r.value))})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:((I=b.find(r=>r.value===x))==null?void 0:I.label)||"گزارش‌ها"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.length.toLocaleString("fa-IR")," مورد"]})]}),e.jsx(se,{data:t,columns:A,loading:h,error:m,emptyMessage:"هیچ گزارشی یافت نشد",searchPlaceholder:"جستجوی گزارش‌ها...",itemsPerPage:25,compact:!0})]})})]})}export{ne as LogsPage,ne as default};
//# sourceMappingURL=LogsPage-BLz9zv-Q.js.map
