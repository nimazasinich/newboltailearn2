import{j as e,p as a,a6 as r,d as s,c as t,a4 as l,_ as d,R as i,x as c,Y as n}from"./ui-aafe698d.js";import{r as g,b as o}from"./vendor-7ccbd9e1.js";import{A as x,a as m}from"./api-config-51aa8efe.js";import{c as y,u as h}from"./index-4616d54e.js";import"./charts-f100c383.js";async function b(e){try{const a=new URLSearchParams;e&&Object.entries(e).forEach(([e,r])=>{void 0!==r&&a.append(e,String(r))});const r=a.toString(),s=r?`${x.LOGS}?${r}`:x.LOGS,t=await m(s),l=await t.json();if(l&&"object"==typeof l){if(Array.isArray(l.logs))return l.logs;if(Array.isArray(l))return l}return[]}catch(a){return console.error("Failed to fetch logs:",a),[]}}function u(){return e.jsxs("div",{className:"animate-pulse space-y-6",role:"status","aria-label":"در حال بارگذاری...",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-9 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:4}).map((a,r)=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-lg"}),e.jsxs("div",{className:"ms-4 space-y-2 flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"}),e.jsx("div",{className:"h-7 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]})]})},`stat-${r}`))}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Array.from({length:6}).map((a,r)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-16 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-600 rounded w-2/3 mx-auto"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2 mx-auto"})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-3 rounded-lg space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-600 rounded w-2/3 mx-auto"}),e.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-600 rounded w-1/2 mx-auto"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 h-10 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 rounded"})]})]},`content-${r}`))}),e.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:"در حال بارگذاری محتوا، لطفاً صبر کنید..."})]})}function p({data:d,columns:i,loading:c=!1,error:n,itemsPerPage:x=10,onRowClick:m,className:h="",emptyMessage:b="داده‌ای یافت نشد",searchPlaceholder:u="جستجو...",showSearch:p=!0,showPagination:j=!0,striped:v=!0,hoverable:f=!0,compact:N=!1}){const[k,w]=g.useState(null),[S,C]=g.useState("asc"),[L,A]=g.useState(1),[R,I]=g.useState(""),M=g.useMemo(()=>{let e=[...d];if(R&&p){const a=i.filter(e=>!1!==e.searchable);e=d.filter(e=>a.some(a=>String(e[a.key]||"").toLowerCase().includes(R.toLowerCase())))}return k&&e.sort((e,a)=>{const r=e[k],s=a[k];if(null==r&&null==s)return 0;if(null==r)return 1;if(null==s)return-1;if("string"==typeof r&&"string"==typeof s)return"asc"===S?r.localeCompare(s,"fa"):s.localeCompare(r,"fa");if("number"==typeof r&&"number"==typeof s)return"asc"===S?r-s:s-r;const t=String(r),l=String(s);return"asc"===S?t.localeCompare(l,"fa"):l.localeCompare(t,"fa")}),e},[d,i,R,k,S,p]),P=Math.ceil(M.length/x),$=(L-1)*x,O=j?M.slice($,$+x):M;o.useEffect(()=>{A(1)},[R]);return c?e.jsxs("div",{className:y("space-y-4",h),children:[p&&e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"}),[...Array(5)].map((a,r)=>e.jsx("div",{className:"h-10 bg-gray-100 dark:bg-gray-800 rounded animate-pulse"},r))]})]}):n?e.jsxs("div",{className:y("text-center py-8",h),children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mb-2",children:"خطا در بارگذاری داده‌ها"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:n})]}):e.jsxs("div",{className:y("space-y-4",h),dir:"rtl",children:[p&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(a,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:u,value:R,onChange:e=>I(e.target.value),className:"w-full pr-10 pl-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"})]}),j&&M.length>0&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["نمایش ",$+1,"-",Math.min($+x,M.length)," از ",M.length," مورد"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"w-full bg-white dark:bg-gray-800",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsx("tr",{children:i.map(a=>{return e.jsx("th",{className:y("px-4 py-3 text-sm font-semibold text-gray-700 dark:text-gray-300",a.sortable&&"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 select-none","center"===a.align&&"text-center","left"===a.align&&"text-left","text-right",N&&"px-2 py-2",a.className),style:{width:a.width},onClick:()=>a.sortable&&(e=>{const a=i.find(a=>a.key===e);(null==a?void 0:a.sortable)&&(k===e?C("asc"===S?"desc":"asc"):(w(e),C("asc")))})(a.key),children:e.jsxs("div",{className:y("flex items-center gap-2","center"===a.align&&"justify-center","left"===a.align&&"justify-start","justify-end"),children:[e.jsx("span",{children:a.title}),a.sortable&&e.jsx("div",{className:"flex flex-col",children:(t=a.key,(k!==t?null:"asc"===S?e.jsx(r,{className:"h-4 w-4"}):e.jsx(s,{className:"h-4 w-4"}))||e.jsxs("div",{className:"text-gray-400",children:[e.jsx(r,{className:"h-3 w-3"}),e.jsx(s,{className:"h-3 w-3 -mt-1"})]}))})]})},String(a.key));var t})})}),e.jsx("tbody",{children:O.length>0?O.map((a,r)=>e.jsx("tr",{className:y("border-t border-gray-100 dark:border-gray-700",v&&r%2==0&&"bg-gray-50/50 dark:bg-gray-800/50",f&&"hover:bg-gray-50 dark:hover:bg-gray-800",m&&"cursor-pointer"),onClick:()=>null==m?void 0:m(a,$+r),children:i.map(s=>e.jsx("td",{className:y("px-4 py-3 text-sm text-gray-900 dark:text-gray-100","center"===s.align&&"text-center","left"===s.align&&"text-left","text-right",N&&"px-2 py-2",s.className),children:s.render?s.render(a[s.key],a,$+r):String(a[s.key]||"")},String(s.key)))},r)):e.jsx("tr",{children:e.jsx("td",{colSpan:i.length,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:b})})})]})}),j&&P>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>A(Math.max(1,L-1)),disabled:1===L,className:"flex items-center gap-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(t,{className:"h-4 w-4"}),"قبلی"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,P)},(a,r)=>{let s;return s=P<=5||L<=3?r+1:L>=P-2?P-4+r:L-2+r,e.jsx("button",{onClick:()=>A(s),className:y("px-3 py-2 text-sm rounded-md",L===s?"bg-primary-600 text-white":"border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700"),children:s.toLocaleString("fa-IR")},s)})}),e.jsxs("button",{onClick:()=>A(Math.min(P,L+1)),disabled:L===P,className:"flex items-center gap-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700",children:["بعدی",e.jsx(l,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["صفحه ",L.toLocaleString("fa-IR")," از ",P.toLocaleString("fa-IR")]})]})]})}function j(){var a;const[r,s]=g.useState([]),[t,l]=g.useState(!0),[o,x]=g.useState(null),[m,y]=g.useState("all"),{showToast:j}=h();g.useEffect(()=>{v()},[m]);const v=async()=>{try{let e;switch(l(!0),x(null),m){case"system":e=await async function(e=100){return b({type:"system",limit:e})}(200);break;case"training":e=await async function(e=100){return b({type:"training",limit:e})}(200);break;case"error":e=await async function(e=50){return b({level:"error",limit:e})}(200);break;default:e=await b({limit:200})}const a=Array.isArray(e)?e:[];s(a)}catch(e){console.error("Failed to load logs:",e),x("خطا در بارگذاری گزارش‌ها"),s([])}finally{l(!1)}},f=e=>{switch(e){case"error":return"🔴";case"warning":return"🟡";case"info":return"🔵";case"debug":return"⚪";default:return"📝"}},N=e=>{switch(e){case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}},k=[{key:"timestamp",title:"زمان",sortable:!0,width:"160px",render:a=>e.jsxs("div",{className:"text-xs font-mono",children:[e.jsx("div",{children:new Date(a).toLocaleDateString("fa-IR")}),e.jsx("div",{className:"text-gray-500",children:new Date(a).toLocaleTimeString("fa-IR")})]})},{key:"level",title:"سطح",sortable:!0,width:"90px",align:"center",render:a=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("span",{children:f(a)}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${N(a)}`,children:a})]})},{key:"category",title:"دسته‌بندی",sortable:!0,width:"120px",render:a=>e.jsx("span",{className:"text-sm bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded text-gray-700 dark:text-gray-300",children:a||"عمومی"})},{key:"message",title:"پیام",render:(a,r)=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm",children:a}),r.model_name&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["مدل: ",r.model_name]}),(void 0!==r.epoch||void 0!==r.accuracy)&&e.jsxs("div",{className:"text-xs text-gray-500 space-x-2 space-x-reverse",children:[void 0!==r.epoch&&e.jsxs("span",{children:["Epoch: ",r.epoch]}),void 0!==r.accuracy&&e.jsxs("span",{children:["دقت: ",(100*r.accuracy).toFixed(1),"%"]}),void 0!==r.loss&&e.jsxs("span",{children:["Loss: ",r.loss.toFixed(4)]})]}),r.metadata&&e.jsxs("details",{className:"text-xs",children:[e.jsx("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-700",children:"جزئیات"}),e.jsx("pre",{className:"mt-1 p-2 bg-gray-100 dark:bg-gray-700 rounded text-xs overflow-auto",children:JSON.stringify(JSON.parse(r.metadata),null,2)})]})]})}],w=[{value:"all",label:"همه گزارش‌ها",count:r.length},{value:"system",label:"سیستم",count:r.filter(e=>"training"!==e.category).length},{value:"training",label:"آموزش",count:r.filter(e=>"training"===e.category).length},{value:"error",label:"خطاها",count:r.filter(e=>"error"===e.level).length}];return t&&0===r.length?e.jsx(u,{showHeader:!0}):e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"گزارش‌های سیستم"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"مشاهده و تحلیل گزارش‌های سیستم و فعالیت‌های آموزش"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{try{const e=[["زمان","سطح","دسته‌بندی","پیام","جزئیات"].join(","),...r.map(e=>[new Date(e.timestamp).toLocaleString("fa-IR"),e.level,e.category||"",`"${e.message.replace(/"/g,'""')}"`,e.metadata?`"${e.metadata.replace(/"/g,'""')}"`:""].join(","))].join("\n"),a=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),t=URL.createObjectURL(a);s.setAttribute("href",t),s.setAttribute("download",`logs_${(new Date).toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),j("گزارش‌ها با موفقیت صادر شد","success")}catch(e){console.error("Failed to export logs:",e),j("خطا در صادرات گزارش‌ها","error")}},disabled:0===r.length,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(d,{className:"h-4 w-4"}),"صادرات CSV"]}),e.jsxs("button",{onClick:v,disabled:t,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50",children:[e.jsx(i,{className:"h-4 w-4 "+(t?"animate-spin":"")}),"بروزرسانی"]})]})]}),o&&e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5 text-red-600"}),e.jsx("p",{className:"text-red-800 dark:text-red-200",children:o})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"فیلتر:"})]}),e.jsx("div",{className:"flex gap-2",children:w.map(a=>e.jsxs("button",{onClick:()=>y(a.value),className:"flex items-center gap-2 px-3 py-1 rounded-lg text-sm transition-colors "+(m===a.value?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[e.jsx("span",{children:a.label}),e.jsx("span",{className:"bg-white dark:bg-gray-800 px-2 py-0.5 rounded-full text-xs",children:a.count.toLocaleString("fa-IR")})]},a.value))})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:(null==(a=w.find(e=>e.value===m))?void 0:a.label)||"گزارش‌ها"}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[r.length.toLocaleString("fa-IR")," مورد"]})]}),e.jsx(p,{data:r,columns:k,loading:t,error:o,emptyMessage:"هیچ گزارشی یافت نشد",searchPlaceholder:"جستجوی گزارش‌ها...",itemsPerPage:25,compact:!0})]})})]})}export{j as LogsPage,j as default};
//# sourceMappingURL=LogsPage-363ffb76.js.map
