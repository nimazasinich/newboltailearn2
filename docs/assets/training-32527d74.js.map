{"version":3,"file":"training-32527d74.js","sources":["../../src/services/training.ts"],"sourcesContent":["import { API_BASE, joinApiPath, apiRequest, API_ENDPOINTS } from '../lib/api-config';\n\nexport interface TrainingConfig {\n  epochs: number;\n  batchSize: number;\n  learningRate: number;\n  validationSplit?: number;\n  earlyStopping?: boolean;\n  patience?: number;\n  modelType?: string;\n  datasetId?: string;\n}\n\nexport interface TrainingSession {\n  id: number;\n  modelId: number;\n  sessionId: string;\n  status: 'running' | 'paused' | 'completed' | 'failed' | 'pending';\n  progress: number;\n  currentEpoch: number;\n  totalEpochs: number;\n  currentStep: number;\n  totalSteps: number;\n  loss: number;\n  accuracy: number;\n  validationLoss?: number;\n  validationAccuracy?: number;\n  learningRate: number;\n  batchSize: number;\n  startTime: string;\n  endTime?: string;\n  estimatedCompletion?: string;\n  errorMessage?: string;\n  config: TrainingConfig;\n  metrics?: any;\n}\n\nexport interface TrainingProgress {\n  epoch: number;\n  loss: number;\n  accuracy: number;\n  validationLoss?: number;\n  validationAccuracy?: number;\n  timestamp: string;\n  progress: number;\n}\n\nexport interface ModelInfo {\n  id: number;\n  name: string;\n  type: string;\n  status: string;\n  accuracy?: number;\n  loss?: number;\n  epochs?: number;\n  currentEpoch?: number;\n  datasetId?: string;\n  config?: any;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport const trainingService = {\n  /**\n   * Get all models\n   */\n  async getModels(page = 1, limit = 10): Promise<{ models: ModelInfo[]; pagination: any }> {\n    try {\n      const params = new URLSearchParams({\n        page: page.toString(),\n        limit: limit.toString()\n      });\n\n      const response = await apiRequest(\n        joinApiPath(API_BASE, `${API_ENDPOINTS.MODELS}?${params.toString()}`)\n      );\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('Get models failed:', error);\n      // Return fallback data for offline mode\n      return {\n        models: [],\n        pagination: { page, limit, total: 0, pages: 0 }\n      };\n    }\n  },\n\n  /**\n   * Get specific model\n   */\n  async getModel(modelId: number): Promise<ModelInfo> {\n    try {\n      const response = await apiRequest(\n        joinApiPath(API_BASE, API_ENDPOINTS.MODEL_BY_ID(modelId.toString()))\n      );\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('Get model failed:', error);\n      // Return fallback model data\n      return {\n        id: modelId,\n        name: 'مدل پیش‌فرض',\n        type: 'persian-bert',\n        status: 'idle',\n        accuracy: 0,\n        loss: 0,\n        epochs: 0,\n        currentEpoch: 0,\n        datasetId: '',\n        config: {},\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n    }\n  },\n\n  /**\n   * Create new model\n   */\n  async createModel(model: { name: string; type: string; datasetId?: string; config?: any }): Promise<ModelInfo> {\n    try {\n      const response = await apiRequest(\n        joinApiPath(API_BASE, API_ENDPOINTS.MODELS),\n        {\n          method: 'POST',\n          body: JSON.stringify(model),\n        }\n      );\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('Create model failed:', error);\n      // Return a mock created model for offline mode\n      return {\n        id: Date.now(),\n        name: model.name,\n        type: model.type,\n        status: 'idle',\n        accuracy: 0,\n        loss: 0,\n        epochs: 0,\n        currentEpoch: 0,\n        datasetId: model.datasetId || '',\n        config: model.config || {},\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString()\n      };\n    }\n  },\n\n  /**\n   * Update model\n   */\n  async updateModel(modelId: number, updates: Partial<ModelInfo>): Promise<{ success: boolean; message: string }> {\n    try {\n      const response = await apiRequest<{ success: boolean; message: string }>(\n        joinApiPath(API_BASE, `/models/${modelId}`),\n        {\n          method: 'PUT',\n          body: JSON.stringify(updates),\n        }\n      );\n      return response;\n    } catch (error) {\n      console.error('Update model failed:', error);\n      throw new Error('خطا در به‌روزرسانی مدل');\n    }\n  },\n\n  /**\n   * Delete model\n   */\n  async deleteModel(modelId: number): Promise<{ success: boolean; message: string }> {\n    try {\n      const response = await apiRequest<{ success: boolean; message: string }>(\n        joinApiPath(API_BASE, `/models/${modelId}`),\n        {\n          method: 'DELETE',\n        }\n      );\n      return response;\n    } catch (error) {\n      console.error('Delete model failed:', error);\n      throw new Error('خطا در حذف مدل');\n    }\n  },\n\n  /**\n   * Start training\n   */\n  async startTraining(modelId: number, config: TrainingConfig): Promise<{\n    success: boolean;\n    message: string;\n    sessionId: string;\n    config: TrainingConfig;\n  }> {\n    try {\n      const response = await apiRequest(\n        joinApiPath(API_BASE, API_ENDPOINTS.MODEL_TRAIN(modelId.toString())),\n        {\n          method: 'POST',\n          body: JSON.stringify(config),\n        }\n      );\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      console.error('Start training failed:', error);\n      // Return mock training session for offline mode\n      return {\n        success: true,\n        message: 'آموزش در حالت آفلاین شروع شد',\n        sessionId: `session_${Date.now()}`,\n        config\n      };\n    }\n  },\n\n  /**\n   * Pause training\n   */\n  async pauseTraining(modelId: number): Promise<{ success: boolean; message: string }> {\n    try {\n      const response = await apiRequest<{ success: boolean; message: string }>(\n        joinApiPath(API_BASE, `/models/${modelId}/pause`),\n        {\n          method: 'POST',\n        }\n      );\n      return response;\n    } catch (error) {\n      console.error('Pause training failed:', error);\n      throw new Error('خطا در توقف آموزش');\n    }\n  },\n\n  /**\n   * Resume training\n   */\n  async resumeTraining(modelId: number, config?: Partial<TrainingConfig>): Promise<{\n    success: boolean;\n    message: string;\n    sessionId: string;\n    config: TrainingConfig;\n  }> {\n    try {\n      const response = await apiRequest<{\n        success: boolean;\n        message: string;\n        sessionId: string;\n        config: TrainingConfig;\n      }>(\n        joinApiPath(API_BASE, `/models/${modelId}/resume`),\n        {\n          method: 'POST',\n          body: JSON.stringify(config || {}),\n        }\n      );\n      return response;\n    } catch (error) {\n      console.error('Resume training failed:', error);\n      throw new Error('خطا در ادامه آموزش');\n    }\n  },\n\n  /**\n   * Get training sessions\n   */\n  async getTrainingSessions(modelId?: number): Promise<TrainingSession[]> {\n    try {\n      const endpoint = modelId \n        ? `/models/${modelId}/sessions`\n        : '/training/sessions';\n\n      const response = await apiRequest<TrainingSession[]>(\n        joinApiPath(API_BASE, endpoint)\n      );\n      return response;\n    } catch (error) {\n      console.error('Get training sessions failed:', error);\n      throw new Error('خطا در دریافت جلسات آموزش');\n    }\n  },\n\n  /**\n   * Get training session by ID\n   */\n  async getTrainingSession(sessionId: string): Promise<TrainingSession> {\n    try {\n      const response = await apiRequest<TrainingSession>(\n        joinApiPath(API_BASE, `/training/sessions/${sessionId}`)\n      );\n      return response;\n    } catch (error) {\n      console.error('Get training session failed:', error);\n      throw new Error('خطا در دریافت جلسه آموزش');\n    }\n  },\n\n  /**\n   * Get model logs\n   */\n  async getModelLogs(modelId: number, page = 1, limit = 50): Promise<{\n    logs: Array<{\n      id: number;\n      level: string;\n      message: string;\n      epoch?: number;\n      loss?: number;\n      accuracy?: number;\n      timestamp: string;\n    }>;\n    pagination: any;\n  }> {\n    try {\n      const params = new URLSearchParams({\n        page: page.toString(),\n        limit: limit.toString()\n      });\n\n      const response = await apiRequest<{\n        logs: Array<{\n          id: number;\n          level: string;\n          message: string;\n          epoch?: number;\n          loss?: number;\n          accuracy?: number;\n          timestamp: string;\n        }>;\n        pagination: any;\n      }>(\n        joinApiPath(API_BASE, `/models/${modelId}/logs?${params.toString()}`)\n      );\n      return response;\n    } catch (error) {\n      console.error('Get model logs failed:', error);\n      throw new Error('خطا در دریافت لاگ‌های مدل');\n    }\n  },\n\n  /**\n   * Get model checkpoints\n   */\n  async getModelCheckpoints(modelId: number): Promise<Array<{\n    id: number;\n    epoch: number;\n    accuracy: number;\n    loss: number;\n    filePath: string;\n    createdAt: string;\n  }>> {\n    try {\n      const response = await apiRequest<Array<{\n        id: number;\n        epoch: number;\n        accuracy: number;\n        loss: number;\n        filePath: string;\n        createdAt: string;\n      }>>(\n        joinApiPath(API_BASE, `/models/${modelId}/checkpoints`)\n      );\n      return response;\n    } catch (error) {\n      console.error('Get model checkpoints failed:', error);\n      throw new Error('خطا در دریافت checkpoint های مدل');\n    }\n  },\n\n  /**\n   * Start hyperparameter optimization\n   */\n  async startOptimization(modelId: number, options: {\n    optimizationType?: string;\n    parameters?: any;\n  } = {}): Promise<{\n    success: boolean;\n    message: string;\n    optimizationId: string;\n    type: string;\n    parameters: any;\n  }> {\n    try {\n      const response = await apiRequest<{\n        success: boolean;\n        message: string;\n        optimizationId: string;\n        type: string;\n        parameters: any;\n      }>(\n        joinApiPath(API_BASE, `/models/${modelId}/optimize`),\n        {\n          method: 'POST',\n          body: JSON.stringify(options),\n        }\n      );\n      return response;\n    } catch (error) {\n      console.error('Start optimization failed:', error);\n      throw new Error('خطا در شروع بهینه‌سازی');\n    }\n  },\n\n  /**\n   * Load model from checkpoint\n   */\n  async loadModel(modelId: number, checkpointPath: string): Promise<{\n    success: boolean;\n    message: string;\n    modelId: number;\n    checkpointPath: string;\n  }> {\n    try {\n      const response = await apiRequest<{\n        success: boolean;\n        message: string;\n        modelId: number;\n        checkpointPath: string;\n      }>(\n        joinApiPath(API_BASE, `/models/${modelId}/load`),\n        {\n          method: 'POST',\n          body: JSON.stringify({ checkpointPath }),\n        }\n      );\n      return response;\n    } catch (error) {\n      console.error('Load model failed:', error);\n      throw new Error('خطا در بارگذاری مدل');\n    }\n  },\n\n  /**\n   * Get training statistics\n   */\n  async getTrainingStats(): Promise<{\n    totalModels: number;\n    activeTraining: number;\n    completedTraining: number;\n    averageAccuracy: number;\n    totalTrainingHours: number;\n  }> {\n    try {\n      const response = await apiRequest<{\n        totalModels: number;\n        activeTraining: number;\n        completedTraining: number;\n        averageAccuracy: number;\n        totalTrainingHours: number;\n      }>(\n        joinApiPath(API_BASE, '/training/stats')\n      );\n      return response;\n    } catch (error) {\n      console.error('Get training stats failed:', error);\n      // Return fallback data\n      return {\n        totalModels: 0,\n        activeTraining: 0,\n        completedTraining: 0,\n        averageAccuracy: 0,\n        totalTrainingHours: 0\n      };\n    }\n  }\n};\n"],"names":["trainingService","getModels","page","limit","params","URLSearchParams","toString","response","apiRequest","joinApiPath","API_BASE","API_ENDPOINTS","MODELS","json","error","console","models","pagination","total","pages","getModel","modelId","MODEL_BY_ID","id","name","type","status","accuracy","loss","epochs","currentEpoch","datasetId","config","createdAt","Date","toISOString","updatedAt","createModel","model","method","body","JSON","stringify","now","updateModel","updates","Error","deleteModel","startTraining","MODEL_TRAIN","success","message","sessionId","pauseTraining","resumeTraining","getTrainingSessions","endpoint","getTrainingSession","getModelLogs","getModelCheckpoints","startOptimization","options","loadModel","checkpointPath","getTrainingStats","totalModels","activeTraining","completedTraining","averageAccuracy","totalTrainingHours"],"mappings":"+DA8DO,MAAMA,EAAkB,CAI7B,eAAMC,CAAUC,EAAO,EAAGC,EAAQ,IAC5B,IACI,MAAAC,EAAS,IAAIC,gBAAgB,CACjCH,KAAMA,EAAKI,WACXH,MAAOA,EAAMG,aAGTC,QAAiBC,EACrBC,EAAYC,EAAU,GAAGC,EAAcC,UAAUR,EAAOE,eAGnD,aADYC,EAASM,aAErBC,GAGA,OAFCC,QAAAD,MAAM,qBAAsBA,GAE7B,CACLE,OAAQ,GACRC,WAAY,CAAEf,OAAMC,QAAOe,MAAO,EAAGC,MAAO,GAEhD,CACF,EAKA,cAAMC,CAASC,GACT,IACF,MAAMd,QAAiBC,EACrBC,EAAYC,EAAUC,EAAcW,YAAYD,EAAQf,cAGnD,aADYC,EAASM,aAErBC,GAGA,OAFCC,QAAAD,MAAM,oBAAqBA,GAE5B,CACLS,GAAIF,EACJG,KAAM,cACNC,KAAM,eACNC,OAAQ,OACRC,SAAU,EACVC,KAAM,EACNC,OAAQ,EACRC,aAAc,EACdC,UAAW,GACXC,OAAQ,CAAC,EACTC,WAAW,IAAIC,MAAOC,cACtBC,WAAW,IAAIF,MAAOC,cAE1B,CACF,EAKA,iBAAME,CAAYC,GACZ,IACF,MAAM/B,QAAiBC,EACrBC,EAAYC,EAAUC,EAAcC,QACpC,CACE2B,OAAQ,OACRC,KAAMC,KAAKC,UAAUJ,KAIlB,aADY/B,EAASM,aAErBC,GAGA,OAFCC,QAAAD,MAAM,uBAAwBA,GAE/B,CACLS,GAAIW,KAAKS,MACTnB,KAAMc,EAAMd,KACZC,KAAMa,EAAMb,KACZC,OAAQ,OACRC,SAAU,EACVC,KAAM,EACNC,OAAQ,EACRC,aAAc,EACdC,UAAWO,EAAMP,WAAa,GAC9BC,OAAQM,EAAMN,QAAU,CAAC,EACzBC,WAAW,IAAIC,MAAOC,cACtBC,WAAW,IAAIF,MAAOC,cAE1B,CACF,EAKA,iBAAMS,CAAYvB,EAAiBwB,GAC7B,IAQK,aAPgBrC,EACrBC,EAAYC,EAAU,WAAWW,KACjC,CACEkB,OAAQ,MACRC,KAAMC,KAAKC,UAAUG,WAIlB/B,GAED,MADEC,QAAAD,MAAM,uBAAwBA,GAChC,IAAIgC,MAAM,yBAClB,CACF,EAKA,iBAAMC,CAAY1B,GACZ,IAOK,aANgBb,EACrBC,EAAYC,EAAU,WAAWW,KACjC,CACEkB,OAAQ,iBAILzB,GAED,MADEC,QAAAD,MAAM,uBAAwBA,GAChC,IAAIgC,MAAM,iBAClB,CACF,EAKA,mBAAME,CAAc3B,EAAiBW,GAM/B,IACF,MAAMzB,QAAiBC,EACrBC,EAAYC,EAAUC,EAAcsC,YAAY5B,EAAQf,aACxD,CACEiC,OAAQ,OACRC,KAAMC,KAAKC,UAAUV,KAIlB,aADYzB,EAASM,aAErBC,GAGA,OAFCC,QAAAD,MAAM,yBAA0BA,GAEjC,CACLoC,SAAS,EACTC,QAAS,+BACTC,UAAW,WAAWlB,KAAKS,QAC3BX,SAEJ,CACF,EAKA,mBAAMqB,CAAchC,GACd,IAOK,aANgBb,EACrBC,EAAYC,EAAU,WAAWW,WACjC,CACEkB,OAAQ,eAILzB,GAED,MADEC,QAAAD,MAAM,yBAA0BA,GAClC,IAAIgC,MAAM,oBAClB,CACF,EAKA,oBAAMQ,CAAejC,EAAiBW,GAMhC,IAaK,aAZgBxB,EAMrBC,EAAYC,EAAU,WAAWW,YACjC,CACEkB,OAAQ,OACRC,KAAMC,KAAKC,UAAUV,GAAU,CAAA,WAI5BlB,GAED,MADEC,QAAAD,MAAM,0BAA2BA,GACnC,IAAIgC,MAAM,qBAClB,CACF,EAKA,yBAAMS,CAAoBlC,GACpB,IACF,MAAMmC,EAAWnC,EACb,WAAWA,aACX,qBAKG,aAHgBb,EACrBC,EAAYC,EAAU8C,UAGjB1C,GAED,MADEC,QAAAD,MAAM,gCAAiCA,GACzC,IAAIgC,MAAM,4BAClB,CACF,EAKA,wBAAMW,CAAmBL,GACnB,IAIK,aAHgB5C,EACrBC,EAAYC,EAAU,sBAAsB0C,YAGvCtC,GAED,MADEC,QAAAD,MAAM,+BAAgCA,GACxC,IAAIgC,MAAM,2BAClB,CACF,EAKA,kBAAMY,CAAarC,EAAiBnB,EAAO,EAAGC,EAAQ,IAYhD,IACI,MAAAC,EAAS,IAAIC,gBAAgB,CACjCH,KAAMA,EAAKI,WACXH,MAAOA,EAAMG,aAiBR,aAdgBE,EAYrBC,EAAYC,EAAU,WAAWW,UAAgBjB,EAAOE,qBAGnDQ,GAED,MADEC,QAAAD,MAAM,yBAA0BA,GAClC,IAAIgC,MAAM,4BAClB,CACF,EAKA,yBAAMa,CAAoBtC,GAQpB,IAWK,aAVgBb,EAQrBC,EAAYC,EAAU,WAAWW,wBAG5BP,GAED,MADEC,QAAAD,MAAM,gCAAiCA,GACzC,IAAIgC,MAAM,mCAClB,CACF,EAKA,uBAAMc,CAAkBvC,EAAiBwC,EAGrC,IAOE,IAcK,aAbgBrD,EAOrBC,EAAYC,EAAU,WAAWW,cACjC,CACEkB,OAAQ,OACRC,KAAMC,KAAKC,UAAUmB,WAIlB/C,GAED,MADEC,QAAAD,MAAM,6BAA8BA,GACtC,IAAIgC,MAAM,yBAClB,CACF,EAKA,eAAMgB,CAAUzC,EAAiB0C,GAM3B,IAaK,aAZgBvD,EAMrBC,EAAYC,EAAU,WAAWW,UACjC,CACEkB,OAAQ,OACRC,KAAMC,KAAKC,UAAU,CAAEqB,2BAIpBjD,GAED,MADEC,QAAAD,MAAM,qBAAsBA,GAC9B,IAAIgC,MAAM,sBAClB,CACF,EAKA,sBAAMkB,GAOA,IAUK,aATgBxD,EAOrBC,EAAYC,EAAU,0BAGjBI,GAGA,OAFCC,QAAAD,MAAM,6BAA8BA,GAErC,CACLmD,YAAa,EACbC,eAAgB,EAChBC,kBAAmB,EACnBC,gBAAiB,EACjBC,mBAAoB,EAExB,CACF"}